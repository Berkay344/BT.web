<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>ESOS Fastfood Sipariş</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f8f9fa;
      color: #333;
    }

    .navbar {
      background-color: #e53935;
      padding: 15px 20px;
      color: white;
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 999;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .navbar i {
      font-size: 22px;
    }

    .container {
      max-width: 600px;
      margin: 30px auto;
      background: #fff;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .logo {
      text-align: center;
      margin-bottom: 20px;
    }

    .logo img {
      max-width: 150px;
    }

    h1 {
      text-align: center;
      font-size: 20px;
      color: #e53935;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .form-group i {
      margin-right: 8px;
      color: #e53935;
    }

    input[type="text"],
    input[type="number"] {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #f9f9f9;
      font-size: 15px;
      transition: 0.3s;
    }

    input:focus {
      outline: none;
      background-color: #fff;
      border-color: #e53935;
    }

    button {
      width: 100%;
      background-color: #e53935;
      color: white;
      padding: 14px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    button:hover {
      background-color: #c62828;
    }

    button::after {
      content: "";
      position: absolute;
      background: rgba(255,255,255,0.3);
      border-radius: 50%;
      transform: scale(0);
      animation: ripple 0.6s linear;
    }

    @keyframes ripple {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }

    button:active::after {
      width: 100px;
      height: 100px;
      top: var(--y);
      left: var(--x);
    }

    .menu-item {
      background-color: #f3f4f6;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #e1e1e1;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .menu-item i {
      margin-right: 10px;
      color: #e53935;
    }

    .menu-item input[type="checkbox"] {
      transform: scale(1.2);
      margin-right: 10px;
    }

    .menu-item input[type="number"] {
      width: 60px;
      padding: 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    .order-box {
      background-color: #fefefe;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 20px;
      line-height: 1.6;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      margin-top: 20px;
    }

    .order-box i {
      color: green;
      margin-right: 5px;
    }

    #order-status {
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <div class="navbar">
    <span><i class="fas fa-burger"></i> ESOS Sipariş</span>
    <i class="fas fa-shopping-bag"></i>
  </div>

  <div class="container">
    <div class="logo">
      <img src="https://i.hizliresim.com/7sp9pd6.png" alt="ESOS Logo">
    </div>

    <h1><i class="fas fa-utensils"></i> Sipariş Formu</h1>

    <div class="form-group">
      <label><i class="fas fa-user"></i> Ad Soyad</label>
      <input type="text" id="name" placeholder="Adınızı girin">
    </div>

    <div class="form-group">
      <label><i class="fas fa-phone"></i> Telefon</label>
      <input type="text" id="phone" placeholder="Telefon numaranız">
    </div>

    <div class="form-group">
      <label><i class="fas fa-comment-dots"></i> Not (isteğe bağlı)</label>
      <input type="text" id="note" placeholder="Acısız olsun, bol kaşarlı...">
    </div>

    <div class="form-group">
      <label><i class="fas fa-list"></i> Menü Seçimi</label>
      <div id="menu-list">Yükleniyor...</div>
    </div>

    <button onclick="submitOrder(event)"><i class="fas fa-paper-plane"></i> Siparişi Gönder</button>

    <h1 style="margin-top: 40px;"><i class="fas fa-box-open"></i> Sipariş Durumu</h1>
    <div id="order-status">Yükleniyor...</div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCDNbgKzJdBKEZUnWH09Az6Z...",
      authDomain: "onlinesiparis-2cf91.firebaseapp.com",
      projectId: "onlinesiparis-2cf91",
      storageBucket: "onlinesiparis-2cf91.appspot.com",
      messagingSenderId: "366801664755",
      appId: "1:366801664755:web:...",
      databaseURL: "https://onlinesiparis-2cf91-default-rtdb.europe-west1.firebasedatabase.app"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const menuList = document.getElementById('menu-list');

    db.ref("menu").on("value", function(snapshot) {
      menuList.innerHTML = "";
      if (!snapshot.exists()) {
        menuList.innerHTML = "Menü bulunamadı.";
        return;
      }

      snapshot.forEach((child) => {
        const item = child.val();
        const key = child.key;
        const div = document.createElement("div");
        div.className = "menu-item";
        div.innerHTML = `
          <input type="checkbox" id="item-${key}" value="${item.name}" data-price="${item.price}">
          <i class="fas fa-hamburger"></i>
          <label for="item-${key}">${item.name} - ₺${item.price}</label>
          <input type="number" id="qty-${key}" min="1" value="1">
        `;
        menuList.appendChild(div);
      });
    });

    function submitOrder(e) {
      const button = e.target;
      const rect = button.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      button.style.setProperty("--x", x + "px");
      button.style.setProperty("--y", y + "px");

      const name = document.getElementById("name").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const note = document.getElementById("note").value.trim();

      if (!name || !phone) {
        Swal.fire("Eksik Bilgi", "Lütfen ad ve telefon numaranızı girin.", "warning");
        return;
      }

      const selectedItems = [];
      document.querySelectorAll("input[type=checkbox]:checked").forEach((checkbox) => {
        const key = checkbox.id.replace("item-", "");
        const itemName = checkbox.value;
        const itemPrice = parseFloat(checkbox.dataset.price);
        const quantity = parseInt(document.getElementById("qty-" + key).value || "1");
        selectedItems.push({ name: itemName, price: itemPrice, quantity });
      });

      if (selectedItems.length === 0) {
        Swal.fire("Ürün Seçilmedi", "Lütfen en az bir ürün seçin.", "info");
        return;
      }

      const now = new Date().toLocaleString();
      const orderData = {
        name,
        phone,
        note,
        items: selectedItems,
        date: now,
        status: "hazırlanıyor"
      };

      const orderRef = db.ref("orders").push();
      orderRef.set(orderData).then(() => {
        localStorage.setItem("orderKey", orderRef.key);
        Swal.fire("Sipariş Alındı", "Siparişiniz hazırlanıyor.", "success");
        listOwnOrder();
      });
    }

    const statusDiv = document.getElementById("order-status");

    function listOwnOrder() {
      const myOrderKey = localStorage.getItem("orderKey");
      if (!myOrderKey) {
        statusDiv.innerHTML = "<em>Henüz sipariş vermediniz.</em>";
        return;
      }

      db.ref("orders/" + myOrderKey).on("value", (snapshot) => {
        statusDiv.innerHTML = "";
        if (!snapshot.exists()) {
          statusDiv.innerHTML = "<em>Siparişiniz bulunamadı.</em>";
          return;
        }

        const order = snapshot.val();
        let itemsText = "";
        let total = 0;

        order.items.forEach(item => {
          const subtotal = item.price * item.quantity;
          total += subtotal;
          itemsText += `• ${item.name} x${item.quantity} - ₺${subtotal}<br>`;
        });

        const noteText = order.note ? `<br><strong>Not:</strong> ${order.note}` : "";

        if (order.status === "onaylandı" && !sessionStorage.getItem("alreadyAlerted")) {
          Swal.fire("Hazır!", "Siparişiniz hazırlandı!", "success");
          sessionStorage.setItem("alreadyAlerted", "1");
        }

        const status = order.status === "onaylandı"
          ? "<span style='color:#4caf50;font-weight:bold;'><i class='fas fa-check-circle'></i> Siparişiniz Hazır</span>"
          : "<span style='color:#e53935;'><i class='fas fa-spinner fa-spin'></i> Hazırlanıyor...</span>";

        statusDiv.innerHTML = `
          <div class="order-box">
            <strong>${order.name} (${order.phone})</strong><br>
            ${itemsText}
            <strong>Toplam: ₺${total}</strong><br>
            <em>${order.date}</em>${noteText}<br>
            ${status}
          </div>
        `;
      });
    }

    window.onload = listOwnOrder;
  </script>
</body>
</html>
