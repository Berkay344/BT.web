<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>ESOS Fastfood SipariÅŸ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f8f9fa;
      color: #333;
    }
    .navbar {
      background-color: #e53935;
      padding: 15px 20px;
      color: white;
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 999;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .container {
      max-width: 600px;
      margin: 30px auto;
      background: #fff;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    .logo { text-align: center; margin-bottom: 20px; }
    .logo img { max-width: 150px; }
    h1 {
      text-align: center;
      font-size: 20px;
      color: #e53935;
      margin-bottom: 20px;
    }
    .form-group { margin-bottom: 20px; }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
    }
    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #f9f9f9;
      font-size: 15px;
    }
    input:focus {
      outline: none;
      background-color: #fff;
      border-color: #e53935;
    }
    button {
      width: 100%;
      background-color: #e53935;
      color: white;
      padding: 14px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
    }
    button:hover { background-color: #c62828; }
    .menu-item {
      background-color: #f3f4f6;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #e1e1e1;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .menu-item input[type="checkbox"] {
      transform: scale(1.2);
      margin-right: 10px;
    }
    .menu-item input[type="number"] {
      width: 60px;
      padding: 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .order-box {
      background-color: #fefefe;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 20px;
      line-height: 1.6;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="navbar">
    <span><i class="fas fa-burger"></i> ESOS SipariÅŸ</span>
    <i class="fas fa-shopping-bag"></i>
  </div>

  <div class="container">
    <div class="logo">
      <img src="https://i.hizliresim.com/7sp9pd6.png" alt="ESOS Logo">
    </div>

    <h1><i class="fas fa-utensils"></i> SipariÅŸ Formu</h1>

    <div class="form-group">
      <label><i class="fas fa-user"></i> Ad Soyad</label>
      <input type="text" id="name" placeholder="AdÄ±nÄ±zÄ± girin">
    </div>

    <div class="form-group">
      <label><i class="fas fa-phone"></i> Telefon</label>
      <input type="text" id="phone" placeholder="Telefon numaranÄ±z">
    </div>

    <div class="form-group">
      <label><i class="fas fa-comment-dots"></i> Not (isteÄŸe baÄŸlÄ±)</label>
      <input type="text" id="note" placeholder="AcÄ±sÄ±z olsun, bol kaÅŸarlÄ±...">
    </div>

    <div class="form-group">
      <label><i class="fas fa-list"></i> MenÃ¼ SeÃ§imi</label>
      <div id="menu-list">YÃ¼kleniyor...</div>
    </div>

    <button onclick="submitOrder(event)"><i class="fas fa-paper-plane"></i> SipariÅŸi GÃ¶nder</button>

    <h1 style="margin-top: 40px;"><i class="fas fa-box-open"></i> SipariÅŸ Durumu</h1>
    <div id="order-status">YÃ¼kleniyor...</div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCDNbgKzJdBKEZUnWH09Az6ZCwUefWJXhY",
      authDomain: "onlinesiparis-2cf91.firebaseapp.com",
      projectId: "onlinesiparis-2cf91",
      storageBucket: "onlinesiparis-2cf91.appspot.com",
      messagingSenderId: "366801664755",
      appId: "1:366801664755:web:57b577f1943ebdf1ab8c85",
      databaseURL: "https://onlinesiparis-2cf91-default-rtdb.europe-west1.firebasedatabase.app"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Sistem durumu kontrolÃ¼
    let aktifUyari = null;

db.ref("sistemDurumu").on("value", (snapshot) => {
  const durum = snapshot.val()?.durum || "acik";
  const neden = snapshot.val()?.neden || "normal";

  if (durum === "kapali") {
    let mesaj = "", ikon = "info";

    if (neden === "normal") {
      mesaj = "Sistem ÅŸu anda <strong>bakÄ±mdadÄ±r</strong>. LÃ¼tfen daha sonra tekrar deneyin.";
      ikon = "warning";
    } else if (neden === "calisma") {
      mesaj = "Åžu anda <strong>Ã§alÄ±ÅŸma saatleri dÄ±ÅŸÄ±nda</strong> olduÄŸumuz iÃ§in sistem kapalÄ±dÄ±r.<br><br><strong>Ã‡alÄ±ÅŸma Saatleri:</strong> 08:00 - 19:30";
      ikon = "info";
    } else if (neden === "carsamba") {
      mesaj = "ðŸ“… <strong>Ã‡arÅŸamba gÃ¼nleri</strong> kapalÄ±yÄ±z. LÃ¼tfen diÄŸer gÃ¼nlerde tekrar gelin.";
      ikon = "error";
    }

    // AynÄ± mesaj tekrar tekrar Ã§Ä±kmasÄ±n diye kontrol
    if (aktifUyari !== neden) {
      aktifUyari = neden;

      Swal.fire({
        icon: ikon,
        title: "ðŸ”’ SipariÅŸ AlÄ±namÄ±yor",
        html: mesaj,
        allowOutsideClick: false,
        allowEscapeKey: false,
        showConfirmButton: false
      });
    }

  } else {
    aktifUyari = null; // sistem aÃ§Ä±ldÄ±ÄŸÄ±nda uyarÄ± sÄ±fÄ±rlansÄ±n
  }
});

    // MenÃ¼ yÃ¼kle
    const menuList = document.getElementById('menu-list');
    db.ref("menu").on("value", function(snapshot) {
      menuList.innerHTML = "";
      if (!snapshot.exists()) {
        menuList.innerHTML = "<em>MenÃ¼ bulunamadÄ±.</em>";
        return;
      }
      snapshot.forEach((child) => {
        const item = child.val();
        const key = child.key;
        const div = document.createElement("div");
        div.className = "menu-item";
        div.innerHTML = `
          <input type="checkbox" id="item-${key}" value="${item.name}" data-price="${item.price}">
          <label for="item-${key}">${item.name} - â‚º${item.price}</label>
          <input type="number" id="qty-${key}" min="1" value="1">
        `;
        menuList.appendChild(div);
      });
    });

    // SipariÅŸ gÃ¶nder
    function submitOrder() {
      const name = document.getElementById("name").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const note = document.getElementById("note").value.trim();

      if (!name || !phone) {
        Swal.fire("Eksik Bilgi", "LÃ¼tfen ad ve telefon numaranÄ±zÄ± girin.", "warning");
        return;
      }

      const selectedItems = [];
      document.querySelectorAll("input[type=checkbox]:checked").forEach((checkbox) => {
        const key = checkbox.id.replace("item-", "");
        const itemName = checkbox.value;
        const itemPrice = parseFloat(checkbox.dataset.price);
        const quantity = parseInt(document.getElementById("qty-" + key).value || "1");
        selectedItems.push({ name: itemName, price: itemPrice, quantity });
      });

      if (selectedItems.length === 0) {
        Swal.fire("ÃœrÃ¼n SeÃ§ilmedi", "LÃ¼tfen en az bir Ã¼rÃ¼n seÃ§in.", "info");
        return;
      }

      const now = new Date().toLocaleString();
      const orderData = {
        name,
        phone,
        note,
        items: selectedItems,
        date: now,
        status: "hazÄ±rlanÄ±yor"
      };

      const orderRef = db.ref("orders").push();
      orderRef.set(orderData).then(() => {
        localStorage.setItem("orderKey", orderRef.key);
        Swal.fire("SipariÅŸ AlÄ±ndÄ±", "SipariÅŸiniz hazÄ±rlanÄ±yor.", "success");
        listOwnOrder();
      });
    }

    // SipariÅŸi listele
    const statusDiv = document.getElementById("order-status");

    function listOwnOrder() {
      const myOrderKey = localStorage.getItem("orderKey");
      if (!myOrderKey) {
        statusDiv.innerHTML = "<em>HenÃ¼z sipariÅŸ vermediniz.</em>";
        return;
      }

      db.ref("orders/" + myOrderKey).on("value", (snapshot) => {
        if (!snapshot.exists()) {
          statusDiv.innerHTML = "<em>SipariÅŸiniz bulunamadÄ±.</em>";
          return;
        }

        const order = snapshot.val();
        let itemsText = "";
        let total = 0;
// EÄŸer sipariÅŸ onaylandÄ±ysa ve daha Ã¶nce uyarÄ± gÃ¶sterilmediyse
if (order.status === "onaylandÄ±" && !localStorage.getItem("siparisUyarisiGosterildi")) {
  Swal.fire({
    icon: 'success',
    title: 'âœ… SipariÅŸiniz HazÄ±r!',
    text: 'LÃ¼tfen teslim almaya hazÄ±rlanÄ±n.',
    confirmButtonText: 'Tamam',
    timer: 3000,
    showConfirmButton: false
  });
  localStorage.setItem("siparisUyarisiGosterildi", "true");
}

        order.items.forEach(item => {
          const subtotal = item.price * item.quantity;
          total += subtotal;
          itemsText += `â€¢ ${item.name} x${item.quantity} - â‚º${subtotal}<br>`;
        });

        const noteText = order.note ? `<br><strong>Not:</strong> ${order.note}` : "";
        const status = order.status === "onaylandÄ±"
          ? "<span style='color:#4caf50;font-weight:bold;'><i class='fas fa-check-circle'></i> SipariÅŸiniz HazÄ±r</span>"
          : "<span style='color:#e53935;'><i class='fas fa-spinner fa-spin'></i> HazÄ±rlanÄ±yor...</span>";

        statusDiv.innerHTML = `
          <div class="order-box">
            <strong>${order.name} (${order.phone})</strong><br>
            ${itemsText}
            <strong>Toplam: â‚º${total}</strong><br>
            <em>${order.date}</em>${noteText}<br>
            ${status}
          </div>
        `;
      });
    }

    window.onload = listOwnOrder;
  </script>
</body>
</html>
